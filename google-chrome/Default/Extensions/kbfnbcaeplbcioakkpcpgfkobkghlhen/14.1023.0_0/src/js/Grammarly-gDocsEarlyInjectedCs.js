var t={d:(e,n)=>{for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},e={};function n(t){return Boolean(t.className)}function r(t){return!Boolean(t.className)}t.d(e,{Cq:()=>f,S1:()=>g,A8:()=>d});const o={logError(){},logException(){},log(){}};function s(t,e,n){return{call(r,o,s,c){var i;const a=c(s),l=null===(i=e.postFn)||void 0===i?void 0:i[o];if(l)try{l(r,t,s,a)}catch(t){n.logException(`proxy.call.${String(o)}`,t)}return a},set(r,o,s,c){var i;const a=null===(i=e.overrideSet)||void 0===i?void 0:i[o];if(a)try{const e=a(r,t,s);if(void 0!==e)return c(e)}catch(t){n.logException(`proxy.set.${String(o)}`,t)}return c(s)}}}function c(t,e=[]){function n(t,r,o){for(let s=o;s<e.length;s++){const o=e[s].get;if(o)return o(t,r,(()=>n(t,r,s+1)))}return Reflect.get(t,r)}function r(t,n,o,s,c){for(let i=c;i<e.length;i++){const c=e[i].call;if(c)return c(t,n,s,(e=>r(t,n,o,e,i+1)))}return o.apply(t,s)}function o(t,n,r,s){for(let c=s;c<e.length;c++){const s=e[c].set;if(s)return s(t,n,r,(e=>o(t,n,e,c+1)))}return Reflect.set(t,n,r)}const s=new Map;return{proxy:new Proxy(t,{get(t,e,o){let c=s.get(e);if(void 0!==c)return c;const i=n(t,e,0);return"function"==typeof i?(c=(...n)=>r(t,e,i,n,0),s.set(e,c),c):i},set:(t,e,n,r)=>o(t,e,n,0)}),addMidleware(t){e.push(t)}}}function i(t){return{middleware:{get(e,n,r){const o=r();return"function"!=typeof o&&t({type:"get",prop:String(n),result:o}),o},call(e,n,r,o){const s=o(r);return t({type:"call",prop:String(n),args:r,result:s}),s},set:(e,n,r,o)=>(t({type:"set",prop:String(n),args:[r]}),o(r))}}}function a(){return{metricsMap:new Map}}const l={overrideSet:{font:(t,e,n)=>(e.fontStyle=function(t){const e=/^(?:([\d\w]+) )?(?:(\w+) )?([\d\.]+)px (?:[\'\"])?([\w \-]+)(?:[\'\"])?$/.exec(t);if(e){const[t,n,r,o,s]=e;let c="400",i="normal";return n&&(isNaN(parseInt(n,10))?"italic"===n?(i="italic",c=isNaN(parseInt(r,10))?"bold"===r?"700":"400":r):c="bold"===n?"700":"400":(c=n,i=r||i)),`${c} ${i} ${parseFloat(o).toFixed(4)}px "${s}"`}return t}(n),n)},postFn:{measureText(t,e,[n],r){if(!e.fontStyle)return;let o=e.metricsMap.get(e.fontStyle);o||(o=new Map,e.metricsMap.set(e.fontStyle,o));const s=n.substr(1,n.length-2),c=[];for(let e=1;e<s.length;e++){const n=s.substr(0,e),r=o.get(n);if(r)c.push(r.chunk);else{const e=t.measureText(n);o.set(n,{chunk:e,charShifts:[...c]}),c.push(e)}}o.set(s,{chunk:r,charShifts:c})}}};const u=[],p=[];function f(t){for(const e of u){const n=t(e.canvas,e.originalContext);n&&e.proxy.addMidleware(n)}p.push(t)}const d=a();function g(){!function(t){const e=self.HTMLCanvasElement.prototype.getContext;self.HTMLCanvasElement.prototype.getContext=function(...n){var r;const o=e.call(this,...n);try{const[e]=n;if("2d"===e&&null!==(s=o)&&void 0!==s.getTransform&&s.getTransform().is2D)return null!==(r=t(this,o))&&void 0!==r?r:o}catch(t){}var s;return o}}(((t,e)=>{const f=p.map((n=>n(t,e))).filter((t=>Boolean(t)));if(n(t)){let t=null,e=[];const n=[e],{middleware:r}=i((r=>{const o=performance.now();null!==t&&t+10<o&&(e=[],n.push(e)),e.push(r),t=o}));f.push(r)}if(r(t)){const{middleware:t}=function({state:t=a(),options:e}){return{state:t,middleware:s(t,l,e)}}({state:d,options:o});f.push(t)}const g=c(e,f);return u.push({canvas:t,originalContext:e,proxy:g}),g.proxy}))}var h=e.Cq,y=e.S1,x=e.A8;export{h as addMiddleware,y as init,x as textMeasuringState};